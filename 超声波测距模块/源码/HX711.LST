C51 COMPILER V7.10   HX711                                                                 04/15/2016 21:28:15 PAGE 1   


C51 COMPILER V7.10, COMPILATION OF MODULE HX711
OBJECT MODULE PLACED IN HX711.OBJ
COMPILER INVOKED BY: d:\program files\Keil\C51\BIN\C51.EXE HX711.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          #include "HX711.h"
   2          #include <reg52.h>
   3          #include <intrins.h>
   4          
   5          sbit CLK_HX711=P2^1;
   6          sbit DAT_HX711=P2^0;
   7          
   8          ulng g_ulEEmpty=0;   //存放设备毛重
   9          
  10          /*********************************************************************
  11           原型: ulng read_HX711AD()
  12           功能: 读取模块返回的24字节数据
  13           返回: 读到的数据
  14          *********************************************************************/
  15          ulng read_HX711()
  16          {
  17   1              ulng count;
  18   1              unsigned char i;
  19   1      
  20   1              DAT_HX711 = 1;
  21   1              _nop_();  _nop_();  _nop_();
  22   1              CLK_HX711 = 0;
  23   1      
  24   1              count = 0;
  25   1              while( DAT_HX711 );
  26   1              for(i=0; i<24; i++)
  27   1              {
  28   2                      CLK_HX711 = 1;
  29   2                      count = count << 1;
  30   2                      CLK_HX711 = 0;
  31   2                      if( DAT_HX711 ) count++;
  32   2              }
  33   1      
  34   1              CLK_HX711 = 1;
  35   1              count = count^0x800000;
  36   1              _nop_();  _nop_();  _nop_();
  37   1              CLK_HX711 = 0;
  38   1      
  39   1              return count;
  40   1      }
  41          
  42          /*********************************************************************
  43           原型: void init_HX711AD()
  44           功能: 初始化HX711AD, 取得设备毛重
  45          *********************************************************************/
  46          void init_HX711()
  47          {
  48   1              g_ulEEmpty = read_HX711();
  49   1              g_ulEEmpty = g_ulEEmpty / 100;
  50   1      }
  51          
  52          /*********************************************************************
  53           原型: ulng getWeight_HX711AD()
  54           功能: 称重
  55          *********************************************************************/
C51 COMPILER V7.10   HX711                                                                 04/15/2016 21:28:15 PAGE 2   

  56          ulng getWeight_HX711()
  57          {
  58   1              ulng ul;
  59   1      
  60   1              ul = read_HX711();
  61   1              ul = ul / 100;
  62   1      
  63   1              if(ul > g_ulEEmpty)
  64   1              {
  65   2                      ul = ul - g_ulEEmpty;    //获取实物的AD采样数值。
  66   2      
  67   2                      #ifdef HX711_40KG  //40公斤
                              ul = (ulng)((float)ul / 1.07 + 0.05 );  //+0.05是为了四舍五入百分位
                              #endif
  70   2      
  71   2                      #ifdef HX711_100KG  //100公斤
  72   2                      ul = (ulng)((float)ul * 2.4589 + 0.05 );        //+0.05是为了四舍五入百分位
  73   2                      #endif
  74   2      
  75   2                      return ul;
  76   2              }
  77   1      
  78   1              return 0;
  79   1      }
  80          
  81          
  82          
  83          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    215    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      4       4
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
