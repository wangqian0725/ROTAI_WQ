C51 COMPILER V7.10   MAIN                                                                  04/15/2016 21:28:15 PAGE 1   


C51 COMPILER V7.10, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: d:\program files\Keil\C51\BIN\C51.EXE main.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          #include "LCD12864.h"
   2          #include "HCSR04.h"
   3          #include "coon.h"
   4          #include "serial.h"
   5          #include "HX711.h"
   6          #include "IndepKey.h"
   7          #include "keys.h"
   8          #include <reg52.h>
   9          #include <stdio.h>
  10          #include <stdlib.h>
  11          #include <string.h>
  12          
  13          ulng  g_lWeight=0;
  14          float g_fHigh=0;
  15          float g_fVal=0;
  16          
  17          void show(int flag)
  18          {
  19   1              int  i1=0, i2=0;
  20   1              char s[17]={0};
  21   1      
  22   1              if( flag == 0 )   //显示待机状态
  23   1              {
  24   2                      show_str_LCD("  体型测量仪    ", 0, 0);
  25   2                      show_str_LCD("                ", 1, 0);
  26   2                      show_str_LCD("                ", 2, 0);
  27   2                      show_str_LCD("                ", 3, 0);
  28   2              }
  29   1              if( flag == 1 )  //显示身高
  30   1              {
  31   2                      memset(s, 0, sizeof(s));
  32   2                      sprintf(s, "身高: %03dCM     ", (int)g_fHigh);
  33   2                      show_str_LCD(s, 1, 0);
  34   2              }
  35   1              if( flag == 2 )  //显示体重
  36   1              {       
  37   2                      memset(s, 0, sizeof(s));
  38   2                      i1 = (int)(g_lWeight/1000);
  39   2                      i2 = g_lWeight%1000/10;
  40   2                      sprintf(s, "体重: %03d.%02dKG  ", i1, i2);
  41   2                      show_str_LCD(s, 2, 0);
  42   2              }
  43   1              if( flag == 3 )  //显示体型
  44   1              {
  45   2                      memset(s, 0, sizeof(s));
  46   2                      sprintf(s, "体型指数: %0.2f ", g_fVal);
  47   2                      show_str_LCD(s, 3, 0);
  48   2              }
  49   1      }
  50          
  51          void main() 
  52          { 
  53   1              int key=0;
  54   1      
  55   1              init_LCD();
C51 COMPILER V7.10   MAIN                                                                  04/15/2016 21:28:15 PAGE 2   

  56   1              init_HX711();
  57   1      
  58   1              show( 0 );
  59   1      
  60   1              while( 1 )
  61   1              {
  62   2                      key = getkey_IndepKey();
  63   2                      if( key == 0 ) continue;
  64   2      
  65   2                      if( key == STD_KEY_IDX_1 )
  66   2                      {
  67   3                              init_HX711();   //去皮
  68   3                              show_str_LCD("    去皮完成    ", 3, 0);
  69   3                              delay_ms(1000);
  70   3                              show_str_LCD("                ", 3, 0);
  71   3                      }
  72   2      
  73   2                      if( key == STD_KEY_IDX_2 ) //进入测量状态
  74   2                      {
  75   3                              key = 0;
  76   3      
  77   3                              //获取身高
  78   3                              while( 1 )
  79   3                              {
  80   4                                      g_fHigh = 200 - get_HCSR04();
  81   4                                      show( 1 );      
  82   4                                      if( getkey_IndepKey() == STD_KEY_IDX_2 ) break;
  83   4                              }
  84   3      
  85   3                              //获得体重
  86   3                              while( 1 )
  87   3                              {
  88   4                                      g_lWeight = getWeight_HX711();
  89   4                                      show( 2 );
  90   4                                      if( getkey_IndepKey() == STD_KEY_IDX_2 ) break;
  91   4                              }
  92   3      
  93   3                              //计算体型
  94   3                              g_fHigh = g_fHigh / 100;  //变为米
  95   3                              g_fVal = ((float)g_lWeight/1000) / (g_fHigh * g_fHigh);
  96   3                              show( 3 );
  97   3      
  98   3                              while( 1 )
  99   3                              {
 100   4                                      if( getkey_IndepKey() == STD_KEY_IDX_2 ) break;
 101   4                              }
 102   3                      }
 103   2      
 104   2                      show( 0 );      
 105   2              }
 106   1      }
 107          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    629    ----
   CONSTANT SIZE    =    123    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     12      25
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
C51 COMPILER V7.10   MAIN                                                                  04/15/2016 21:28:15 PAGE 3   

END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
